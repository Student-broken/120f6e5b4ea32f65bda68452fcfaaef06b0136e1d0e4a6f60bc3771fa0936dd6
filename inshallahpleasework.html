<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analyseur Dynamique V10 (Pathfinder V2)</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <style>
        :root {
            /* Animation */
            --transition-duration: 0.3s;

            /* ORIGINAL (Modernized) Color Palette */
            --primary-color: #5B21B6;   /* Purple */
            --secondary-color: #059669; /* Green */
            --warning-color: #F59E0B; /* Amber */
            --danger-color: #DC2626;  /* Red */
            --violet-color: var(--primary-color);
            --orange-color: #C2410C;

            /* Light Mode Variables */
            --background-color: #f9fafb;
            --widget-background: #ffffff;
            --widget-darker-color: #f3f4f6;
            --text-color: #1f2937;
            --text-color-light: #6b7280;
            --border-color: #e5e7eb;
            --shadow-widget: 0 4px 16px rgba(0,0,0,.08);
            --shadow-widget-light: 0 1px 4px rgba(0,0,0,.08);
            --input-bg-color: #ffffff;
            --primary-bg-light: #f5f3ff;
            --primary-text-light: #4c1d95;
            --gauge-gradient: linear-gradient(90deg, var(--danger-color), var(--warning-color), var(--secondary-color));

            /* Badge Colors (Light) */
            --badge-green-bg: #D1FAE5; --badge-green-text: #065F46;
            --badge-yellow-bg: #FEF3C7; --badge-yellow-text: #92400E;
            --badge-red-bg: #FEE2E2; --badge-red-text: #991B1B;
            --badge-violet-bg: #E9D5FF; --badge-violet-text: #5B21B6;
            --badge-blue-bg: #DBEAFE; --badge-blue-text: #1E40AF;
            --badge-orange-bg: #FFEDD5; --badge-orange-text: #C2410C;
        }

        [data-theme="dark"] {
            /* Dark Mode Palette */
            --primary-color: #8B5CF6;     /* Lighter Purple */
            --secondary-color: #10B981;   /* Lighter Green */
            --warning-color: #FBBF24;   /* Lighter Amber */
            --danger-color: #F87171;    /* Lighter Red */
            --violet-color: var(--primary-color);
            --orange-color: #F97316;

            /* Dark Mode Variables */
            --background-color: #111827;
            --widget-background: #1f2937;
            --widget-darker-color: #374151;
            --text-color: #f9fafb;
            --text-color-light: #9ca3af;
            --border-color: #374151;
            --shadow-widget: 0 4px 16px rgba(0,0,0,.2);
            --shadow-widget-light: 0 1px 4px rgba(0,0,0,.2);
            --input-bg-color: #374151;
            --primary-bg-light: #2d2a43;
            --primary-text-light: #A78BFA;
            --gauge-gradient: linear-gradient(90deg, var(--danger-color), var(--warning-color), var(--secondary-color));

            /* Badge Colors (Dark) */
            --badge-green-bg: #065F46; --badge-green-text: #D1FAE5;
            --badge-yellow-bg: #92400E; --badge-yellow-text: #FEF3C7;
            --badge-red-bg: #991B1B; --badge-red-text: #FEE2E2;
            --badge-violet-bg: #5B21B6; --badge-violet-text: #E9D5FF;
            --badge-blue-bg: #1E40AF; --badge-blue-text: #DBEAFE;
            --badge-orange-bg: #C2410C; --badge-orange-text: #FFEDD5;
        }

        /* GLOBAL TRANSITIONS */
        body, .side-panel, .modal-content, .tab-btn, .tab-content, 
        .subject-table, .prediction-card, .score-card, .ai-insight-box, 
        select, input, .gauge-bar, .gauge-needle {
            transition: background-color var(--transition-duration) ease, 
                        color var(--transition-duration) ease, 
                        border-color var(--transition-duration) ease, 
                        box-shadow var(--transition-duration) ease,
                        left var(--transition-duration) ease-out;
        }

        @keyframes fadeInSlideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .main-container, .floating-buttons-container {
            opacity: 0;
            transform: translateY(20px);
            animation: fadeInSlideUp 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
        }
        .main-container { animation-delay: 0.1s; }

        /* General Styles */
        body {
            margin: 0;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
        }

        /* Floating Action Buttons */
        .icon-btn {
            background-color: var(--widget-background);
            border: 1px solid var(--border-color);
            color: var(--text-color-light);
            width: 44px; height: 44px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1em;
            box-shadow: var(--shadow-widget);
            transition: all 0.2s ease, background-color var(--transition-duration);
            text-decoration: none;
        }
        .icon-btn:hover {
            border-color: var(--primary-color);
            color: var(--primary-color);
            transform: scale(1.1) translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,.12);
        }

        /* Main Layout (Better Spacing) */
        .main-container {
            display: flex;
            min-height: 100vh;
            max-width: 1800px;
            margin: 0 auto;
            padding: 2rem;
            gap: 2rem;
        }
        .side-panel {
            width: 100%;
            max-width: 380px;
            background-color: var(--side-panel-color);
            padding: 1.75rem;
            box-shadow: var(--shadow-widget);
            border-radius: 16px;
            margin: 0;
            height: fit-content;
        }
        @media (max-width: 1024px) {
            .main-container { flex-direction: column; padding: 1rem; gap: 1.5rem; }
            .side-panel { max-width: 100%; position: static; }
        }
        .content-area {
            flex-grow: 1;
            padding: 0;
        }
        
        /* Typography */
        h1, h2, h3, h4 {
            color: var(--text-color);
            font-family: 'Inter', sans-serif;
            font-weight: 700;
        }
        h1 { font-size: 1.875rem; margin-bottom: 1.5rem; }
        h2 { font-size: 1.5rem; margin-bottom: 1rem; }
        h3 { font-size: 1.25rem; margin-bottom: 1rem; margin-top: 2rem; }
        .content-area h3 { margin-top: 2.5rem; }
        h4 { font-size: 1rem; margin-bottom: 0.5rem; }

        /* Tabs (Polished) */
        .tab-btn {
            padding: .75rem 1.5rem;
            font-weight: 600;
            border-radius: .5rem .5rem 0 0;
            border-bottom: 3px solid transparent;
            cursor: pointer;
            background-color: transparent;
            color: var(--text-color-light);
            margin-right: .25rem;
            position: relative;
            top: 2px;
        }
        .tab-btn:hover {
            color: var(--primary-color);
            background-color: var(--widget-darker-color);
        }
        .tab-btn.active {
            background-color: var(--widget-background);
            border-bottom: 3px solid var(--primary-color);
            color: var(--primary-color);
        }
        .tab-content {
            background-color: var(--widget-background);
            padding: 2rem;
            border-radius: 0 .75rem .75rem .75rem;
            box-shadow: var(--shadow-widget);
        }
        .tab-content:not(.active) { display: none; }

        /* Subject Table */
        .subject-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            margin-top: 1.5rem;
            box-shadow: var(--shadow-widget);
            border-radius: .75rem;
            overflow: hidden;
            margin-bottom: 1.5rem;
            border: 1px solid var(--border-color);
        }
        .subject-table thead th {
            padding: 1rem 1.25rem;
            text-align: left;
            background-color: var(--widget-darker-color);
            color: var(--text-color);
            font-weight: 700;
            border-bottom: 1px solid var(--border-color);
        }
        .subject-table thead tr:first-child th {
            font-size: 1.25rem;
            text-align: center;
            background-color: var(--primary-color);
            color: white;
        }
        .subject-table tbody tr:nth-child(even) {
            background-color: var(--widget-darker-color);
        }
        .subject-table td {
            padding: 0.75rem 1.25rem;
            border-bottom: 1px solid var(--border-color);
            color: var(--text-color);
        }
        .subject-table tr:last-child td { border-bottom: none; }
        .grade-percentage {
            font-weight: 700;
            color: var(--primary-color);
        }

        /* ** NEW/RESTORED DYNAMIC STYLES **
         Styles for dynamic content from your original file
        */
        .subject-analysis {
            background-color: var(--primary-bg-light);
            border: 1px solid var(--border-color);
            padding: 1.25rem;
            border-radius: .75rem;
            margin-top: -1rem;
            margin-bottom: 1.5rem;
        }
        .analysis-badge {
            display: inline-flex;
            align-items: center;
            padding: .25rem .75rem;
            border-radius: 9999px;
            font-size: .875rem;
            font-weight: 600;
            margin-right: .5rem;
            border: 1px solid transparent;
        }
        .badge-green { background-color: var(--badge-green-bg); color: var(--badge-green-text); border-color: var(--badge-green-text);}
        .badge-yellow { background-color: var(--badge-yellow-bg); color: var(--badge-yellow-text); border-color: var(--badge-yellow-text);}
        .badge-red { background-color: var(--badge-red-bg); color: var(--badge-red-text); border-color: var(--badge-red-text);}
        .badge-violet { background-color: var(--badge-violet-bg); color: var(--badge-violet-text); border-color: var(--badge-violet-text);}
        .badge-blue { background-color: var(--badge-blue-bg); color: var(--badge-blue-text); border-color: var(--badge-blue-text);}
        .badge-orange { background-color: var(--badge-orange-bg); color: var(--badge-orange-text); border-color: var(--badge-orange-text);}

        .prediction-card {
            background-color: var(--widget-background);
            padding: 1rem 1.25rem;
            border-radius: 10px;
            border-left: 5px solid;
            margin-bottom: 1rem;
            box-shadow: var(--shadow-widget-light);
            border: 1px solid var(--border-color);
            transition: all .2s;
        }
        .prediction-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-widget);
        }
        .card-green { border-left-color: var(--secondary-color); }
        .card-violet { border-left-color: var(--violet-color); }
        .card-yellow { border-left-color: var(--warning-color); }
        .card-red { border-left-color: var(--danger-color); }
        .card-score {
            font-size: 1.875rem;
            font-weight: 800;
            margin-top: .25rem;
        }
        /* End of new/restored styles */

        /* Probability Table */
        .probability-table {
             border: 1px solid var(--border-color);
             box-shadow: var(--shadow-widget-light);
             border-radius: .75rem;
             overflow: hidden;
        }
        .probability-table th, .probability-table td {
            padding: .75rem;
            text-align: center;
            border: 1px solid var(--border-color);
        }
        .probability-table thead tr { background-color: var(--widget-darker-color); }
        .prob-high { background-color: var(--badge-green-bg); color: var(--badge-green-text); font-weight: 700; }
        .prob-medium { background-color: var(--badge-yellow-bg); color: var(--badge-yellow-text); }
        .prob-low { background-color: var(--badge-red-bg); color: var(--badge-red-text); }

        /* Modals */
        .modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex; justify-content: center; align-items: center;
            z-index: 1000;
            opacity: 0; visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s;
        }
        .modal.active { opacity: 1; visibility: visible; }
        .modal-content {
            background: var(--widget-background);
            padding: 2rem 2.5rem;
            border-radius: 12px;
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1);
            max-width: 90%;
            width: 500px;
            transform: scale(0.9) translateY(-20px);
            transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275), background-color var(--transition-duration), color var(--transition-duration);
        }
        .modal.active .modal-content {
            transform: scale(1) translateY(0);
        }
        .modal-close {
            position: absolute; top: 10px; right: 15px;
            font-size: 2em; cursor: pointer; color: var(--text-color-light);
            line-height: 1; z-index: 1001;
        }

        /* Side Panel Score Cards (Better Spacing) */
        .score-card {
            display: flex;
            align-items: center;
            padding: 1rem;
            border-radius: .75rem;
            background-color: var(--widget-darker-color);
            border: 1px solid var(--border-color);
        }
        .score-card strong { font-size: 1.5rem; color: var(--text-color); }
        .score-card p { margin: 0; color: var(--text-color-light); font-size: 0.875rem; }
        .score-icon { font-size: 1.75rem; margin-right: 1rem; width: 32px; text-align: center; }
        .effort-needed { font-size: 1.25rem; font-weight: 700; }
        
        /* Inputs & Sliders */
        .slider-label { font-weight: 600; margin-top: 1rem; }
        select, input[type="range"] {
            width: 100%;
            margin-top: 0.5rem;
            background-color: var(--input-bg-color);
            color: var(--text-color);
            border: 1px solid var(--border-color);
            border-radius: 8px;
        }
        select {
            padding: 12px;
            font-weight: 500;
            -webkit-appearance: none; appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20' fill='%236b7280'%3E%3Cpath fill-rule='evenodd' d='M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z' clip-rule='evenodd' /%3E%3C/svg%3E");
            background-repeat: no-repeat; background-position: right 15px center; background-size: 20px;
        }
        [data-theme="dark"] select {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20' fill='%239ca3af'%3E%3Cpath fill-rule='evenodd' d='M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z' clip-rule='evenodd' /%3E%3C/svg%3E");
        }
        input[type="range"] {
            -webkit-appearance: none;
            appearance: none;
            height: 8px;
            background-color: var(--border-color);
            border-radius: 4px;
            padding: 0;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background-color: var(--primary-color);
            border: 2px solid var(--widget-background);
            cursor: pointer;
            box-shadow: 0 0 5px rgba(0,0,0,.2);
        }

        /* AI Insight Box */
        .ai-insight-box {
            background-color: var(--primary-bg-light);
            border: 1px solid var(--primary-color);
            border-radius: .75rem;
            padding: 1.25rem;
            margin-top: .75rem;
        }
        .ai-insight-box h4 {
            display: flex;
            align-items: center;
            font-size: 1rem;
            font-weight: 700;
            color: var(--primary-text-light);
            margin-bottom: .75rem;
            margin-top: 0;
        }
        .ai-insight-box h4 span { font-size: 1.25rem; margin-right: .5rem; }
        .ai-insight-box ul { list-style-type: none; padding-left: 0; font-size: .875rem; margin: 0;}
        .ai-insight-box li {
            position: relative;
            padding-left: 1.75rem;
            margin-bottom: .5rem;
            color: var(--text-color);
            line-height: 1.5;
        }
        .ai-insight-box li:last-child { margin-bottom: 0; }
        .ai-insight-box li::before {
            font-size: 1rem;
            position: absolute;
            left: 0;
            top: 1px;
        }
        .ai-insight-box li.insight-good::before { content: '‚úÖ'; }
        .ai-insight-box li.insight-info::before { content: '‚ÑπÔ∏è'; }
        .ai-insight-box li.insight-trend::before { content: 'üìà'; }
        .ai-insight-box li.insight-focus::before { content: 'üéØ'; }
        .ai-insight-box li.insight-priority::before { content: 'üß†'; }
        .ai-insight-box li.insight-erratic::before { content: '‚ö°'; }

        /* Gauge (Polished) */
        .gauge-container {
            width: 100%;
            padding: .5rem 0;
            margin-top: .5rem;
            margin-bottom: 1.5rem;
        }
        .gauge-bar {
            width: 100%;
            height: 12px;
            background: var(--gauge-gradient);
            border-radius: 6px;
            position: relative;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, .1);
        }
        .gauge-needle {
            position: absolute;
            top: -6px;
            width: 6px;
            height: 24px;
            background-color: var(--text-color);
            border-radius: 3px;
            border: 2px solid var(--widget-background);
            box-shadow: 0 1px 5px rgba(0, 0, 0, .4);
            transform: translateX(-50%);
        }
        .gauge-labels {
            display: flex;
            justify-content: space-between;
            font-size: .875rem;
            font-weight: 600;
            color: var(--text-color-light);
            margin-top: .75rem;
        }

        /* Help Modal */
        #help-modal .modal-content {
            width: 750px;
            max-width: 95%;
            max-height: 90vh;
            overflow-y: auto;
            text-align: left;
        }
        .help-title {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 1rem;
            text-align: left;
        }
        .help-section-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--primary-color);
            margin-top: 1.5rem;
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 4px;
            margin-bottom: 1rem;
        }
        #help-modal h4 {
            font-size: 1.0rem;
            font-weight: 700;
            color: var(--text-color);
            margin-top: 1.25rem;
            margin-bottom: .25rem;
        }
        #help-modal p, #help-modal li {
            font-size: .95rem;
            color: var(--text-color-light);
            line-height: 1.6;
            margin-top: .5rem;
        }
        #help-modal ul { list-style-type: disc; padding-left: 2rem; }
        #help-modal ol.detailed-list { list-style-type: decimal; padding-left: 1.5rem; }
        #help-modal ol.detailed-list > li { font-weight: 600; color: var(--text-color); margin-top: 1rem; }
        #help-modal ol.detailed-list > li > ul { margin-top: .25rem; font-weight: normal; }
        #help-modal b { font-weight: 600; color: var(--text-color); }

        /* Utility */
        .space-y-3 { display: flex; flex-direction: column; gap: 1rem; }
        .space-y-2 { display: flex; flex-direction: column; gap: 0.5rem; }
        .space-y-4 { display: flex; flex-direction: column; gap: 1rem; }
        .border-b { border-bottom: 1px solid var(--border-color); }
        .pb-2 { padding-bottom: 0.5rem; }
        .mb-4 { margin-bottom: 1rem; }
        .mb-3 { margin-bottom: 0.75rem; }
        .mb-2 { margin-bottom: 0.5rem; }
        .mt-4 { margin-top: 1rem; }
        .mt-6 { margin-top: 1.5rem; }
        .pt-3 { padding-top: 0.75rem; }
        .block { display: block; }
        .font-medium { font-weight: 500; }
        .text-sm { font-size: 0.875rem; }
        .text-xs { font-size: 0.75rem; }
        .text-gray-500 { color: var(--text-color-light); }
        .text-gray-700 { color: var(--text-color); }
        .text-gray-800 { color: var(--text-color); }
        .-mt-2 { margin-top: -0.5rem; }
        .w-full { width: 100%; }
        .flex { display: flex; }
        .space-x-2 { gap: 0.5rem; }
        .rounded-lg { border-radius: .75rem; }
        .p-4 { padding: 1rem; }
        .border-l-4 { border-left-width: 4px; }
        .text-4xl { font-size: 2.5rem; }
        .font-extrabold { font-weight: 800; }
        .text-violet-700 { color: var(--primary-color); }
        .text-red-600 { color: var(--danger-color); }
        .text-orange-600 { color: var(--warning-color); }
    </style>
</head>
<body>

<a href="main.html" class="icon-btn" title="Retour √† la page principale" style="position: fixed; top: 15px; left: 15px; z-index: 1001;">
    <i class="fa-solid fa-arrow-left"></i>
</a>
<div class="floating-buttons-container" style="position: fixed; top: 15px; right: 15px; z-index: 1001; display: flex; gap: 10px;">
    <button id="theme-toggle" class="icon-btn" aria-label="Changer de th√®me (Mode Clair/Sombre)">
        <i class="fa-solid fa-moon"></i>
    </button>
    <button id="open-help-btn" class="icon-btn" title="Comment √ßa marche ?">
        <i class="fa-solid fa-question"></i>
    </button>
</div>


<div id="help-modal" class="modal">
    <div class="modal-content">
        <span id="close-help-modal" class="modal-close">&times;</span>
        <h2 class="help-title">Guide D√©taill√© de l'Analyseur</h2>
        
        <p>Cet outil analyse votre <b>tendance</b> (votre "√©lan") et votre <b>volatilit√©</b> (votre stabilit√©) pour pr√©dire vos performances. Voici ce que chaque terme signifie en d√©tail.</p>

        <h3 class="help-section-title">Section Sp√©ciale : La R√©gression Lin√©aire (Le C≈ìur de l'IA)</h3>
        
        <h4>Qu'est-ce que c'est ?</h4>
        <p>Le "Moteur de D√©couverte (IA)" utilise un outil statistique appel√© <b>R√©gression Lin√©aire</b>. Son but est de trouver la "ligne de tendance" (la ligne droite de meilleur ajustement) qui passe au milieu d'un nuage de points de donn√©es. 


[Image of a scatter plot with a positive trend line]

</p>
        <p>L'IA n'analyse pas seulement vos notes, elle analyse la <b>relation</b> entre deux variables. L'application effectue 3 analyses de r√©gression distinctes :</p>
        
        <ol class="detailed-list">
            <li><b>Mod√®le 1 : TENDANCE (Note vs. Temps)</b>
                <ul>
                    <li><b>(Axe X) :</b> Le temps (Devoir 1, Devoir 2, Devoir 3...)</li>
                    <li><b>(Axe Y) :</b> La note obtenue (85%, 88%, 87%...)</li>
                    <li><b>Ce qu'elle cherche :</b> "Est-ce que vos notes <b>montent</b> ou <b>baissent</b> avec le temps ?" C'est votre √©lan, ou "pente". C'est ce qui alimente le "Facteur de Tendance Globale".</li>
                </ul>
            </li>
            <li><b>Mod√®le 2 : FOCUS (Note vs. Pond√©ration du Devoir)</b>
                <ul>
                    <li><b>(Axe X) :</b> L'importance du devoir (Ex: 5%, 10%, 40%...)</li>
                    <li><b>(Axe Y) :</b> La note obtenue (95%, 90%, 82%...)</li>
                    <li><b>Ce qu'elle cherche :</b> "Avez-vous tendance √† mieux r√©ussir les <b>petits devoirs</b> ou les <b>gros examens</b> ?" Une pente n√©gative ici est un signal d'alarme : cela signifie que plus un examen est important, plus votre note a tendance √† baisser.</li>
                </ul>
            </li>
            <li><b>Mod√®le 3 : PRIORIT√â (Note vs. Pond√©ration de la Comp√©tence)</b>
                <ul>
                    <li><b>(Axe X) :</b> L'importance de la comp√©tence (Ex: 30%, 40%, 60%...)</li>
                    <li><b>(Axe Y) :</b> La note obtenue dans cette comp√©tence (90%, 85%, 80%...)</li>
                    <li><b>Ce qu'elle cherche :</b> "√ätes-vous meilleur dans les comp√©tences mineures ou majeures ?"</li>
                </ul>
            </li>
        </ol>

        <h4>Ce qui INFLUENCE la R√©gression (Votre question)</h4>
        <p>La "ligne de tendance" est comme une balan√ßoire. Ce qui l'influence le plus, ce sont les <b>points aberrants (Outliers)</b> et la <b>dispersion</b> de vos notes.</p>
        <ul>
            <li><b>Les Points Aberrants (Outliers) :</b> C'est l'influence n¬∞1. Si vous avez une moyenne de 90% mais que vous tombez malade et obtenez <b>20%</b> √† un examen, ce seul point tirera la "ligne de tendance" <b>massivement</b> vers le bas. L'IA verra cela comme une forte tendance n√©gative. De m√™me, un 100% facile sur un devoir tirera la ligne vers le haut.</li>
            <li><b>La Fiabilit√© (Le R¬≤) :</b> C'est le "Niveau de Confiance" de l'IA. C'est la statistique la plus importante que l'IA regarde.
                <ul>
                    <li>Un <b>R¬≤ √©lev√© (ex: 0.8 ou 80%)</b> signifie que vos notes sont tr√®s proches de la ligne de tendance. Le sch√©ma est <b>fiable</b>. L'IA peut affirmer avec certitude "Vous √™tes en hausse".</li>
                    <li>Un <b>R¬≤ faible (ex: 0.1 ou 10%)</b> signifie que vos notes sont "erratiques" et totalement dispers√©es autour de la ligne. Le sch√©ma est <b>non fiable</b>. C'est √† ce moment que l'IA vous dit : <b>"Je n'ai trouv√© aucun sch√©ma fiable"</b>, car la tendance qu'elle a trouv√©e n'explique que 10% de vos r√©sultats.</li>
                </ul>
            </li>
            <li><b>Le Nombre de Points (N) :</b> Une tendance sur 3 devoirs ne veut rien dire. Une tendance sur 30 devoirs est un sch√©ma tr√®s fort. C'est pourquoi l'IA ignore les mati√®res avec moins de 5 notes.</li>
        </ul>

        <h3 class="help-section-title">Panneau Principal (Gauche)</h3>
        
        <h4>Pr√©diction Globale Stochastique (Tendance MC)</h4>
        <p>"MC" signifie <b>Monte Carlo</b>. L'outil simule <b>100 000 sc√©narios possibles</b> pour l'√âtape 3. Chaque simulation est un "jet de d√©" bas√© sur :</p>
        <ol>
            <li><b>Votre moyenne projet√©e</b> (bas√©e sur la <b>Pente</b> de votre R√©gression Lin√©aire "Tendance").</li>
            <li><b>Votre volatilit√©</b> (votre <b>√âcart-Type</b>, ou "StdDev"). Un √©tudiant stable (faible volatilit√©) aura des simulations group√©es (ex: 88-92%). Un √©tudiant erratique (haute volatilit√©) aura des simulations dispers√©es (ex: 70-100%).</li>
        </ol>
        <p>Le score affich√© est le <b>P50 (M√©dian)</b> : le point exact o√π 50 000 simulations ont fait pire et 50 000 ont fait mieux. C'est le r√©sultat le plus probable.</p>

        <h4>Jauge de Performance (P5 √† P95)</h4>
        <p>C'est la carte compl√®te des 100 000 simulations :</p>
        <ul>
            <li><b>P5 (Pessimiste) :</b> 95 000 simulations ont donn√© un meilleur score. C'est votre "pire" sc√©nario probable.</li>
            <li><b>P50 (M√©dian) :</b> Le centre, identique √† la pr√©diction "Tendance MC".</li>
            <li><b>P95 (Optimiste) :</b> Seulement 5 000 simulations ont fait mieux. C'est le sc√©nario "r√™v√©".</li>
        </ul>

        <h4>Indices de Risque Dynamique</h4>
        <ul>
            <li><b>Indice de Consistance :</b> C'est l'inverse de votre <b>Volatilit√© (√âcart-Type)</b>. Un score de 100 signifie un √âcart-Type de 0 (ex: 90%, 90%, 90%). Un score bas signifie que vos notes sont tr√®s dispers√©es (ex: 60%, 100%, 75%).</li>
            <li><b>Risque de Burnout :</b> Score (sur 100) bas√© sur 4 facteurs : <b>1.</b> Volatilit√© (l'instabilit√© est stressante), <b>2.</b> Tendance (une pente n√©gative est un signe de difficult√©), <b>3.</b> Charge de travail (Unit√©s), <b>4.</b> Absent√©isme.</li>
            <li><b>Facteur de Tendance Globale :</b> C'est la <b>Pente (Slope)</b> de votre R√©gression "Tendance" x 10. (Ex: Pente de +0.2 = +2.0% F.T.G. = Vous gagnez 0.2 points par devoir, ou 2 points tous les 10 devoirs).</li>
        </ul>

        <h3 class="help-section-title">Analyse D√©taill√©e (Droite)</h3>

        <h4>Analyse de D√©s√©quilibre (Mismatch)</h4>
        <p>Cette section identifie les mati√®res "risqu√©es". Le "Score Mismatch" est √©lev√© si une mati√®re a :</p>
        <ul>
            <li><b>1. Une haute Volatilit√© (√âcart-Type) :</b> Vos notes sont tr√®s dispers√©es.</li>
            <li><b>2. Une faible Consistance :</b> Vos notes sont impr√©visibles.</li>
        </ul>
        <p>Une mati√®re "Rouge" (Mismatch √©lev√©) est une bombe √† retardement. C'est l√† que vous devez vous concentrer pour <b>stabiliser</b> vos r√©sultats (ex: visez des 80-90 constants plut√¥t que des 70-100 altern√©s).</p>

        <h4>Analyse de Chemin (Probabilit√©s)</h4>
        <p>Cette section vous donne un plan d'action. Elle r√©pond √† deux questions : <b>1.</b> "De quelle moyenne ai-je besoin ?" et <b>2.</b> "Quelles sont mes chances de l'obtenir ?"</p>
        <ul>
            <li><b>Moyenne Requise E2/E3 :</b> C'est un calcul alg√©brique simple pour d√©terminer la note exacte que vous devez obtenir √† l'√©tape 2 (ou 3) pour atteindre un objectif global.</li>
            <li><b>Probabilit√© (%) :</b> C'est la partie la plus importante. L'outil utilise la <b>Distribution Normale (CDF)</b>. Il compare la "Moyenne Requise" √† votre "Jauge de Performance (P5-P95)".</li>
            <li><b>Exemple :</b> Si votre "Moyenne Requise" est de <b>80%</b>, mais que votre jauge P5-P95 est entre 85% et 95%, votre probabilit√© de l'atteindre sera tr√®s √©lev√©e (ex: 99%), car 80% est en dessous de votre "pire" sc√©nario. Si la "Moyenne Requise" est de <b>96%</b>, elle est au-dessus de votre P95, donc la probabilit√© sera tr√®s faible (ex: <5%).</li>
        </ul>
    </div>
</div>


<div class="main-container">

    <div class="side-panel lg:sticky lg:top-4">
        <h2 class="text-2xl font-bold mb-4 text-gray-800 border-b pb-2">Moteur Stochastique V10 (Fix)</h2>

        <div class="bg-violet-100 p-4 rounded-lg mb-4 border-l-4 border-violet-600" style="background-color: var(--primary-bg-light); border-left-color: var(--primary-color); margin-bottom: 1.5rem;">
            <p class="text-sm font-medium text-gray-700" style="color: var(--text-color-light);">Pr√©diction Globale Stochastique (Tendance MC)</p>
            <strong id="moyenne-prediction" class="text-4xl font-extrabold text-violet-700" style="color: var(--primary-color);">--</strong>
        </div>

        <h3 class="text-lg font-semibold text-gray-800" style="margin-top: 0;">Jauge de Performance (P5 √† P95)</h3>
        <div class="gauge-container">
            <div class="gauge-bar">
                <div id="gauge-needle" class="gauge-needle" style="left: 50%;"></div>
            </div>
            <div class="gauge-labels">
                <span id="gauge-label-p5">P5: --%</span>
                <strong id="gauge-label-p50" style="color: var(--primary-color);">P50: --%</strong>
                <span id="gauge-label-p95">P95: --%</span>
            </div>
        </div>
        
        <h3 class="text-lg font-semibold mt-6 mb-3 text-gray-800 border-b pb-2">Indices de Risque Dynamique</h3>
        <div id="deep-analysis-scorecard" class="space-y-3 mb-6">
            <div class="score-card score-high" id="consistency-score">
                <span class="score-icon text-gray-600">üéØ</span>
                <div>
                    <p class="text-sm font-medium text-gray-500">Indice de Consistance/Volatilit√© (100 = Parfait)</p>
                    <strong class="text-xl text-gray-800">--</strong>
                </div>
            </div>
            <div class="score-card score-low" id="burnout-risk-score">
                <span class="score-icon text-red-600">üî•</span>
                <div>
                    <p class="text-sm font-medium text-gray-500">Score de Risque de Burnout (100 = Risque Maximal)</p>
                    <strong class="text-xl text-red-600">--</strong>
                </div>
            </div>

            <div class="ai-insight-box" id="ai-insight-container">
                <h4><span>üîé</span> Moteur de D√©couverte (IA)</h4>
                <p class="text-xs text-gray-500 -mt-2 mb-3">L'IA a scann√© vos donn√©es et a trouv√© les corr√©lations les plus fortes (R¬≤ > 0.25) :</p>
                <ul id="ai-insights-list">
                    </ul>
            </div>
            
            <div class="score-card score-low" id="dff-score">
                <span class="score-icon text-orange-600">üìâ</span>
                <div>
                    <p class="text-sm font-medium text-gray-500">Facteur de Tendance Globale (Pente / 10 devoirs)</p>
                    <strong class="text-xl text-orange-600">--</strong>
                </div>
            </div>
        </div>

        <h3 class="text-lg font-semibold mt-4 mb-2 text-gray-700 border-t pt-3">Param√®tres Actuels</h3>
        <div class="space-y-3 mb-6 text-sm">
            <div>
                <label for="niveau-secondaire" class="block text-sm font-medium text-gray-700">Niveau Secondaire</label>
                <select id="niveau-secondaire">
                    <option value="">S√©lectionner</option>
                    <option value="sec4">Secondaire 4</option>
                    <option value="sec5">Secondaire 5</option>
                </select>
            </div>
            <div>
                <label class="slider-label block text-sm font-medium text-gray-700" style="margin-top: 0;">Taux d'Absent√©isme/D√©sengagement</label>
                <input type="range" id="absence-rate-slider" min="0" max="25" step="0.5" value="5" class="w-full mt-1">
                <p class="text-xs text-gray-500 mt-1" style="font-size: 0.8rem;">Impact sur B-Risk : <span id="absence-rate-value">5.0%</span></p>
            </div>

            <div>
                <label for="unites-mode" class="block text-sm font-medium text-gray-700">Mode Unit√©s (Pond√©ration)</label>
                <div class="flex space-x-2">
                    <select id="unites-mode" style="flex: 1;">
                        <option value="defaut">D√©faut (Officiel)</option>
                        <option value="sans">Sans Unit√©s (Moy. Simple)</option>
                        <option value="perso">Personnalis√©</option>
                    </select>
                    <button id="unites-btn" style="padding: 8px 12px; background-color: var(--widget-darker-color); border: 1px solid var(--border-color); border-radius: 8px; color: var(--text-color); font-weight: 500;">√âditer</button>
                </div>
            </div>
        </div>

        <h3 class="text-lg font-semibold mt-4 mb-2 text-gray-700 border-t pt-3">Moyennes par Mati√®re (<span id="active-etape-name">1</span>)</h3>
        <ul id="subject-averages-list" class="space-y-2 text-base" style="padding-left: 0; list-style: none;">
            </ul>
    </div>

    <div class="content-area">
        <h1 class="text-3xl font-bold mb-4 text-gray-800">D√©tails de Performance & Pr√©dictions</h1>

        <div class="flex border-b border-gray-200 mb-4" style="border-bottom: 2px solid var(--border-color);">
            <button class="tab-btn active" data-tab="etape1">√âtape 1 - Analyse</button>
            <button class="tab-btn" data-tab="etape2">√âtape 2 - Analyse</button>
            <button class="tab-btn" data-tab="etape3">√âtape 3 - Projection</button>
            <button class="tab-btn" data-tab="simulation">Monte Carlo & Probabilit√©s</button>
        </div>

        <div id="tab-contents">
            <div id="etape1" class="tab-content active">
                </div>
            <div id="etape2" class="tab-content">
                </div>
            <div id="etape3" class="tab-content">
                </div>

            <div id="simulation" class="tab-content">
                <h2 class="text-2xl font-bold mb-4 text-primary-color" style="color: var(--primary-color);">Analyse Pr√©dictive Stochastique (100,000 Sc√©narios)</h2>
                <p class="text-gray-600 mb-6 border-b pb-4">
                    *Le mod√®le utilise la **R√©gression Lin√©aire** pour la tendance de base et projette la performance. Les probabilit√©s sont calcul√©es √† l'aide d'une **CDF Normale** bas√©e sur la tendance et la volatilit√© (StdDev) de vos notes. Ces donn√©es sont des estimations statistiques.*
                </p>

                <h3 class="text-xl font-semibold mb-3 mt-4 text-gray-700">Pr√©dictions de Moyenne Finale Globale (Intervalles de Confiance)</h3>
                <div id="global-predictions" class="grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-4" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem;">
                    </div>

                <h3 class="text-xl font-semibold mb-3 mt-8 text-gray-700 border-t pt-4">Analyse de D√©s√©quilibre Volatilit√© / Effort (Mismatch)</h3>
                <div id="mismatch-analysis" class="space-y-4">
                    </div>

                <h3 class="text-xl font-semibold mb-3 mt-8 text-gray-700 border-t pt-4">Analyse de Chemin : Moyenne Requise √† l'√âtape 2</h3>
                <p class="text-sm text-gray-600 mb-4">Moyenne exacte que vous devez obtenir √† l'**√âtape 2** (bas√© sur E1 et la projection E3) pour atteindre chaque objectif global.</p>
                <table class="probability-table w-full rounded-lg overflow-hidden">
                    <thead>
                        <tr class="bg-gray-100">
                            <th>Objectif Global (%)</th>
                            <th>Moyenne Requise E2 (%)</th>
                            <th>Probabilit√© (%)</th>
                            <th>Analyse du Risque</th>
                        </tr>
                    </thead>
                    <tbody id="probability-table-body-e2">
                        </tbody>
                </table>

                <h3 class="text-xl font-semibold mb-3 mt-8 text-gray-700 border-t pt-4">Analyse de Chemin : Moyenne Requise √† l'√âtape 3</h3>
                <p class="text-sm text-gray-600 mb-4">Moyenne exacte que vous devez obtenir √† l'**√âtape 3** (bas√© sur E1+E2) pour atteindre chaque objectif global.</p>
                <table class="probability-table w-full rounded-lg overflow-hidden">
                    <thead>
                        <tr class="bg-gray-100">
                            <th>Objectif Global (%)</th>
                            <th>Moyenne Requise E3 (%)</th>
                            <th>Probabilit√© (%)</th>
                            <th>Analyse du Risque</th>
                        </tr>
                    </thead>
                    <tbody id="probability-table-body-e3">
                        </tbody>
                </table>

                 <h3 class="text-xl font-semibold mb-3 mt-8 text-gray-700 border-t pt-4">Pr√©dictions Tendancielles D√©taill√©es par Mati√®re</h3>
                <p class="text-sm text-gray-600 mb-4">Pr√©diction de note finale (E1+E2+E3) bas√©e sur la **Tendance par R√©gression Lin√©aire**. **Plafond√© au Max. Historique + 5%**.</p>
                <div id="subject-predictions-list" class="space-y-3">
                    </div>
            </div>
        </div>
    </div>
</div>

<div id="unites-modal" class="modal">
    <div class="modal-content">
        <h3 class="text-xl font-bold mb-4">Unit√©s par Mati√®re</h3>
        <p class="text-sm text-gray-500 mb-4">Ajustez les unit√©s pour chaque mati√®re si le mode 'Personnalis√©' est s√©lectionn√©.</p>
        <div id="unites-list" class="max-h-80 overflow-y-auto border p-3 rounded-md space-y-2" style="max-height: 300px; overflow-y: auto; border: 1px solid var(--border-color); padding: 0.75rem; border-radius: 8px;">
            </div>
        <div class="mt-6 flex justify-end" style="margin-top: 1.5rem; display: flex; justify-content: flex-end;">
            <button id="close-unites-modal" class="bg-primary-color text-white px-4 py-2 rounded-md" style="background-color: var(--primary-color); color: white; padding: 0.75rem 1.25rem; border-radius: 8px; border: none; font-weight: 600;">Fermer & Appliquer</button>
        </div>
    </div>
</div>

<script src="js/projected-averages.js"></script> 
<script src="js/projection.js"></script>

<script>
    document.addEventListener('DOMContentLoaded', () => {

        // --- 1. Theme Toggle Logic ---
        const themeToggle = document.getElementById('theme-toggle');
        const html = document.documentElement;
        const toggleIcon = themeToggle.querySelector('i');
        const THEME_KEY = 'pathfinder-theme-v2'; // Use a new key to avoid cache issues

        const updateTheme = (theme) => {
            html.setAttribute('data-theme', theme);
            localStorage.setItem(THEME_KEY, theme);
            if (theme === 'dark') {
                toggleIcon.classList.remove('fa-moon');
                toggleIcon.classList.add('fa-sun');
            } else {
                toggleIcon.classList.remove('fa-sun');
                toggleIcon.classList.add('fa-moon');
            }
        };

        const storedTheme = localStorage.getItem(THEME_KEY);
        const initialTheme = storedTheme || (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
        updateTheme(initialTheme);

        themeToggle.addEventListener('click', () => {
            const currentTheme = html.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            updateTheme(newTheme);
        });

        // --- 2. Tab Switching Logic ---
        const tabButtons = document.querySelectorAll('.tab-btn');
        const tabContents = document.querySelectorAll('.tab-content');

        tabButtons.forEach(button => {
            button.addEventListener('click', () => {
                const targetTab = button.getAttribute('data-tab');

                tabButtons.forEach(btn => btn.classList.remove('active'));
                button.classList.add('active');

                tabContents.forEach(content => {
                    content.classList.add('active'); // Keep all active for a moment
                    if (content.id !== targetTab) {
                        content.classList.remove('active');
                    }
                });
                
                // Update active etape name in side panel
                const activeEtapeName = document.getElementById('active-etape-name');
                if (activeEtapeName) {
                    if (targetTab.startsWith('etape')) {
                        activeEtapeName.textContent = targetTab.replace('etape', '');
                    }
                }
            });
        });

        // --- 3. Modal Logic ---
        const setupModal = (openBtnId, modalId, closeBtnId) => {
            const openBtn = document.getElementById(openBtnId);
            const modal = document.getElementById(modalId);
            const closeBtn = document.getElementById(closeBtnId);

            if (openBtn && modal && closeBtn) {
                const open = () => modal.classList.add('active');
                const close = () => modal.classList.remove('active');

                openBtn.addEventListener('click', open);
                closeBtn.addEventListener('click', close);
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        close();
                    }
                });
            }
        };

        setupModal('open-help-btn', 'help-modal', 'close-help-modal');
        setupModal('unites-btn', 'unites-modal', 'close-unites-modal');
        
        // --- 4. Absence Slider Value Display ---
        const absenceSlider = document.getElementById('absence-rate-slider');
        const absenceValue = document.getElementById('absence-rate-value');
        if(absenceSlider && absenceValue) {
            absenceSlider.addEventListener('input', () => {
                absenceValue.textContent = `${parseFloat(absenceSlider.value).toFixed(1)}%`;
            });
        }
    });
</script>

</body>
</html>
